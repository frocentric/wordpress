!function(l){"use strict";if(void 0!==l){var r=[],o=function(t){return r=l.grep(r,function(e){return e!==t&&0<e.$instance.closest("body").length})},n={keyup:"onKeyUp",resize:"onResize"},i=function(e){l.each(s.opened().reverse(),function(){if(!e.isDefaultPrevented()&&!1===this[n[e.type]](e))return e.preventDefault(),e.stopPropagation(),!1})},a=function(e){if(e!==s._globalHandlerInstalled){s._globalHandlerInstalled=e;var t=l.map(n,function(e,t){return t+"."+s.prototype.namespace}).join(" ");l(window)[e?"on":"off"](t,i)}};s.prototype={constructor:s,namespace:"featherlight",targetAttr:"data-featherlight",variant:null,resetCss:!1,background:null,openTrigger:"click",closeTrigger:"click",filter:null,root:"body",openSpeed:250,closeSpeed:250,closeOnClick:"background",closeOnEsc:!0,closeIcon:"&#10005;",loading:"",persist:!1,otherClose:null,beforeOpen:l.noop,beforeContent:l.noop,beforeClose:l.noop,afterOpen:l.noop,afterContent:l.noop,afterClose:l.noop,onKeyUp:l.noop,onResize:l.noop,type:null,contentFilters:["jquery","image","html","ajax","iframe","text"],setup:function(e,t){"object"!=typeof e||e instanceof l!=!1||t||(t=e,e=void 0);var n=l.extend(this,t,{target:e}),r=n.resetCss?n.namespace+"-reset":n.namespace,o=l(n.background||['<div class="'+r+"-loading "+r+'">','<div class="'+r+'-content">','<span class="'+r+"-close-icon "+n.namespace+'-close">',n.closeIcon,"</span>",'<div class="'+n.namespace+'-inner">'+n.loading+"</div>","</div>","</div>"].join("")),i="."+n.namespace+"-close"+(n.otherClose?","+n.otherClose:"");return n.$instance=o.clone().addClass(n.variant),n.$instance.on(n.closeTrigger+"."+n.namespace,function(e){var t=l(e.target);("background"===n.closeOnClick&&t.is("."+n.namespace)||"anywhere"===n.closeOnClick||t.closest(i).length)&&(n.close(e),e.preventDefault())}),this},getContent:function(){if(!1!==this.persist&&this.$content)return this.$content;var t=this,e=this.constructor.contentFilters,n=function(e){return t.$currentTarget&&t.$currentTarget.attr(e)},r=n(t.targetAttr),o=t.target||r||"",i=e[t.type];if(!i&&o in e&&(i=e[o],o=t.target&&r),o=o||n("href")||"",!i)for(var a in e)t[a]&&(i=e[a],o=t[a]);if(!i){var s=o;if(o=null,l.each(t.contentFilters,function(){return(i=e[this]).test&&(o=i.test(s)),!o&&i.regex&&s.match&&s.match(i.regex)&&(o=s),!o}),!o)return"console"in window&&window.console.error("Featherlight: no content filter found "+(s?' for "'+s+'"':" (no target specified)")),!1}return i.process.call(t,o)},setContent:function(e){var t=this;return(e.is("iframe")||0<l("iframe",e).length)&&t.$instance.addClass(t.namespace+"-iframe"),t.$instance.removeClass(t.namespace+"-loading"),t.$instance.find("."+t.namespace+"-inner").not(e).slice(1).remove().end().replaceWith(l.contains(t.$instance[0],e[0])?"":e),t.$content=e.addClass(t.namespace+"-inner"),t},open:function(t){var n=this;if(n.$instance.hide().appendTo(n.root),!(t&&t.isDefaultPrevented()||!1===n.beforeOpen(t))){t&&t.preventDefault();var e=n.getContent();if(e)return r.push(n),a(!0),n.$instance.fadeIn(n.openSpeed),n.beforeContent(t),l.when(e).always(function(e){n.setContent(e),n.afterContent(t)}).then(n.$instance.promise()).done(function(){n.afterOpen(t)})}return n.$instance.detach(),l.Deferred().reject().promise()},close:function(e){var t=this,n=l.Deferred();return!1===t.beforeClose(e)?n.reject():(0===o(t).length&&a(!1),t.$instance.fadeOut(t.closeSpeed,function(){t.$instance.detach(),t.afterClose(e),n.resolve()})),n.promise()},resize:function(e,t){if(e&&t){this.$content.css("width","").css("height","");var n=Math.max(e/(parseInt(this.$content.parent().css("width"),10)-1),t/(parseInt(this.$content.parent().css("height"),10)-1));1<n&&(n=t/Math.floor(t/n),this.$content.css("width",""+e/n-50+"px").css("height",""+t/n-50+"px"))}},chainCallbacks:function(e){for(var t in e)this[t]=l.proxy(e[t],this,l.proxy(this[t],this))}},l.extend(s,{id:0,autoBind:"[data-featherlight]",defaults:s.prototype,contentFilters:{jquery:{regex:/^[#.]\w/,test:function(e){return e instanceof l&&e},process:function(e){return!1!==this.persist?l(e):l(e).clone(!0)}},image:{regex:/\.(png|jpg|jpeg|gif|tiff|bmp|svg)(\?\S*)?$/i,process:function(e){var t=l.Deferred(),n=new Image,r=l('<img src="'+e+'" alt="" class="'+this.namespace+'-image" />');return n.onload=function(){r.naturalWidth=n.width,r.naturalHeight=n.height,t.resolve(r)},n.onerror=function(){t.reject(r)},n.src=e,t.promise()}},html:{regex:/^\s*<[\w!][^<]*>/,process:function(e){return l(e)}},ajax:{regex:/./,process:function(e){var n=l.Deferred(),r=l("<div></div>").load(e,function(e,t){"error"!==t&&n.resolve(r.contents()),n.fail()});return n.promise()}},iframe:{process:function(e){var t=new l.Deferred,n=l("<iframe/>").hide().attr("src",e).css(function(e,t){var n={},r=new RegExp("^"+t+"([A-Z])(.*)");for(var o in e){var i=o.match(r);i&&(n[(i[1]+i[2].replace(/([A-Z])/g,"-$1")).toLowerCase()]=e[o])}return n}(this,"iframe")).on("load",function(){t.resolve(n.show())}).appendTo(this.$instance.find("."+this.namespace+"-content"));return t.promise()}},text:{process:function(e){return l("<div>",{text:e})}}},functionAttributes:["beforeOpen","afterOpen","beforeContent","afterContent","beforeClose","afterClose"],readElementConfig:function(e,t){var r=this,o=new RegExp("^data-"+t+"-(.*)"),i={};return e&&e.attributes&&l.each(e.attributes,function(){var e=this.name.match(o);if(e){var t=this.value,n=l.camelCase(e[1]);if(0<=l.inArray(n,r.functionAttributes))t=new Function(t);else try{t=l.parseJSON(t)}catch(e){}i[n]=t}}),i},extend:function(e,t){var n=function(){this.constructor=e};return n.prototype=this.prototype,e.prototype=new n,e.__super__=this.prototype,l.extend(e,this,t),e.defaults=e.prototype,e},attach:function(r,o,i){var a=this;"object"!=typeof o||o instanceof l!=!1||i||(i=o,o=void 0);var s,e=(i=l.extend({},i)).namespace||a.defaults.namespace,c=l.extend({},a.defaults,a.readElementConfig(r[0],e),i);return r.on(c.openTrigger+"."+c.namespace,c.filter,function(e){var t=l.extend({$source:r,$currentTarget:l(this)},a.readElementConfig(r[0],c.namespace),a.readElementConfig(this,c.namespace),i),n=s||l(this).data("featherlight-persisted")||new a(o,t);"shared"===n.persist?s=n:!1!==n.persist&&l(this).data("featherlight-persisted",n),t.$currentTarget.blur(),n.open(e)}),r},current:function(){var e=this.opened();return e[e.length-1]||null},opened:function(){var t=this;return o(),l.grep(r,function(e){return e instanceof t})},close:function(e){var t=this.current();if(t)return t.close(e)},_onReady:function(){var t=this;t.autoBind&&(l(t.autoBind).each(function(){t.attach(l(this))}),l(document).on("click",t.autoBind,function(e){e.isDefaultPrevented()||"featherlight"===e.namespace||(e.preventDefault(),t.attach(l(e.currentTarget)),l(e.target).trigger("click.featherlight"))}))},_callbackChain:{onKeyUp:function(e,t){return 27===t.keyCode?(this.closeOnEsc&&l.featherlight.close(t),!1):e(t)},onResize:function(e,t){return this.resize(this.$content.naturalWidth,this.$content.naturalHeight),e(t)},afterContent:function(e,t){var n=e(t);return this.onResize(t),n}}}),l.featherlight=s,l.fn.featherlight=function(e,t){return s.attach(this,e,t)},l(document).ready(function(){s._onReady()})}else"console"in window&&window.console.info("Too much lightness, Featherlight needs jQuery.");function s(e,t){if(!(this instanceof s)){var n=new s(e,t);return n.open(),n}this.id=s.id++,this.setup(e,t),this.chainCallbacks(s._callbackChain)}}(jQuery);
