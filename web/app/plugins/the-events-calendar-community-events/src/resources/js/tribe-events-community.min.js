var tribe_community_events=tribe_community_events||{};!function(e,t,i){"use strict";i.$window=t(e),i.$datepickers=t(),i.$timepickers=t(),i.els={uploadArea:document.querySelector(".tribe-image-upload-area"),uploadFile:document.getElementById("uploadFile"),eventImage:document.getElementById("EventImage"),detachThumbnail:document.getElementById("tribe-events-community-detach-thumbnail")},i.date_to_ymd=function(e){var t=e.getDate(),i=e.getMonth()+1;return e.getFullYear()+"-"+(i<=9?"0"+i:i)+"-"+(t<=9?"0"+t:t)},i.init_linked_posts_handle=function(){var e=t(".move-linked-post-group"),i=t(".saved-linked-post");e.addClass("hidden"),i.on("change",function(){t(i).closest(e).removeClass("hidden"),t(this).find(e).removeClass("hidden")})},i.init_mobile_datetime_input=function(){i.$datepickers=t("#EventStartDate, #EventEndDate"),i.$timepickers=t("#EventStartTime, #EventEndTime"),i.$window.on({"resize.tribe":function(){i.$window.width()<=568?(i.$datepickers.on("change.tribe",i.on_change_datepicker).trigger("change"),void 0!==t.fn.tribeTimepicker?i.$timepickers.tribeTimepicker("option","disableTouchKeyboard",!0):i.$timepickers.timepicker("option","disableTouchKeyboard",!0)):(i.$datepickers.prop("type","text"),i.$datepickers.off("change.tribe"),void 0!==t.fn.tribeTimepicker?i.$timepickers.tribeTimepicker("option","disableTouchKeyboard",!1):i.$timepickers.timepicker("option","disableTouchKeyboard",!1))},load:function(){i.$window.trigger("resize.tribe")}})},i.on_change_datepicker=function(){var e=t(this),n=i.$datepickers.not(e),a="start",r=t(this).data("datepicker"),o=t.datepicker.parseDate(r.settings.dateFormat||t.datepicker._defaults.dateFormat,e.val(),r.settings),s=t.datepicker.parseDate(r.settings.dateFormat||t.datepicker._defaults.dateFormat,n.val(),r.settings);"EventEndDate"!==e.attr("name")&&"EventEndDate"!==e.attr("id")||(a="end"),"start"===a?(n.attr("min",i.date_to_ymd(o)),s<o&&n.val(i.date_to_ymd(o))):s>o&&n.val(i.date_to_ymd(o))},i.init_local_storage=function(){e.localStorage&&t(".tribe-toggle-column").on("change",function(){var i=t(this),n=i.attr("id");e.localStorage.getItem(n);i.is(":checked")?e.localStorage.removeItem(n):e.localStorage.setItem(n,"1")}).each(function(){var i=t(this),n=i.attr("id");e.localStorage.getItem(n)&&i.prop("checked",!1).trigger("change")})},i.init_image_input=function(){var e=t(i.els.uploadArea);t(i.els.eventImage).on("change",function(){var e=this.value.split("\\").pop();i.els.uploadArea.classList.add("uploaded"),i.els.detachThumbnail.setAttribute("value",!1),i.els.uploadFile.setAttribute("value",e),i.els.uploadFile.setAttribute("size",e.length)}),e.on("click",".tribe-remove-upload a",function(e){e.preventDefault(),i.removeEventImage()}),e.on("click",".submitdelete",function(e){e.preventDefault(),i.removeEventImage(),i.detachThumbnail()})},i.removeEventImage=function(){i.els.uploadArea.classList.remove("uploaded"),i.els.uploadArea.classList.remove("has-image"),i.els.uploadFile.setAttribute("value",""),i.els.uploadFile.value="",i.els.eventImage.setAttribute("value",""),i.els.eventImage.value=""},i.detachThumbnail=function(){i.els.detachThumbnail.setAttribute("value",!0)},i.init_list_columns_menu=function(){var e=t(".table-menu");t(".table-menu-btn").click(function(){return t(this).toggleClass("menu-open").parent().find(".table-menu").toggleClass("table-menu-hidden"),!1}),t(document).click(function(i){t(i.target).is(e)||t(i.target).is(t(e).find("*"))||t(e).addClass("table-menu-hidden")})},i.remove_no_js_class=function(){t(document.getElementById("tribe-events")).removeClass("tribe-no-js").addClass("tribe-js")},i.datetime_selectors=function(){"object"==typeof tribe_dynamic_helper_text&&tribe_dynamic_helper_text.event_date_change()},i.is_form_field_empty=function(e,t){for(var i=0;i<t.length;i++){if("undefined"!=typeof tinyMCE&&null!==tinyMCE.get(e))return""===tinyMCE.get(e).getContent();if(e==t[i].name)return""===t[i].value}return!1},i.add_js_form_errors=function(e){var i=t("#tribe-community-events");i.find(".tribe-community-js-notice").remove();var n=t("<div />",{class:"tribe-community-notice tribe-community-js-notice tribe-community-notice-error"});n.insertBefore(i.find("form"));for(var a=0;a<e.length;a++)if(void 0!==tribe_submit_form_i18n.errors[e[a]]){var r=tribe_submit_form_i18n.errors[e[a]];t("<p />",{text:r}).appendTo(n)}},i.disallow_submission_while_creating_linked_posts=function(){t("#tribe-community-events form").on("submit",function(e){var n=t(this),a=(n.serializeArray(),[]);return n.find(".required").each(function(e){if("checkbox"===t(this).attr("type")&&!t(this).prop("checked"))return a.push(t(this).attr("name")),!0;""===t(this).val()&&a.push(t(this).attr("name"))}),!a.length||(i.add_js_form_errors(a),t("html, body").animate({scrollTop:n.closest("#tribe-community-events").offset().top},300),!1)})},i.delete_post=function(){t(".delete.wp-admin.events-cal .submitdelete").on("click",function(e){if(e.preventDefault(),!t(e.target).data("event_id"))return!1;if(!confirm("Are you sure you want to delete this event? This cannot be undone!"))return!1;var i=e.target,n=i.dataset.event_id,a=i.dataset.nonce,r=t(i.closest("tr"));return t.ajax({url:TEC.ajaxurl,method:"GET",data:{action:"tribe_events_community_delete_post",nonce:a,id:n},success:function(e){!0===e.success&&r.fadeOut(function(){r.remove()})},complete:function(e){var i=t.parseJSON(e.responseText);alert(i.data)}}),!1})},t(document).ready(i.init_mobile_datetime_input).ready(i.init_image_input).ready(i.init_list_columns_menu).ready(i.init_local_storage).ready(i.init_linked_posts_handle).ready(i.remove_no_js_class).ready(i.remove_no_js_class).ready(i.setup_dropdowns).ready(i.datetime_selectors).ready(i.disallow_submission_while_creating_linked_posts).ready(i.delete_post)}(window,jQuery,tribe_community_events);