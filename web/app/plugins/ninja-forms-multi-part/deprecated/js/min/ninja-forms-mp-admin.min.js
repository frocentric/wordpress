function nf_mp_change_page(e,n){if(!n)var n="";nfPages.current_page=e,jQuery(".mp-page-nav").removeClass("active"),jQuery("#ninja_forms_mp_page_"+e).addClass("active");var a=jQuery("#ninja_forms_field_list_"+e).position().left;jQuery("#ninja-forms-slide").animate({left:-a},"300",n)}function nf_mp_get_field_order(){jQuery("._page_divider-li").removeClass("not-sortable"),jQuery(".ninja-forms-field-list").sortable("refresh");var e="";jQuery(".ninja-forms-field-list").each(function(){""!=e&&(e+=","),e+=jQuery(this).sortable("toArray")}),e=e.split(",");for(var n={},a=0;a<e.length;a++)n[a]=e[a];return jQuery("._page_divider-li").addClass("not-sortable"),JSON.stringify(n)}function nf_mp_remove_array_value(e){for(var n,a,i=arguments,t=i.length;t>1&&e.length;)for(n=i[--t];-1!==(a=e.indexOf(n));)e.splice(a,1);return e}var nfPage=Backbone.Model.extend({duplicate:function(){var e=ninja_forms_settings.form_id;nfFields.updateData();var n=JSON.stringify(nfFields.toJSON());jQuery(".mp-spinner").show(),jQuery.post(ajaxurl,{form_id:e,field_ids:this.get("fields"),field_data:n,action:"nf_mp_copy_page",nf_ajax_nonce:ninja_forms_settings.nf_ajax_nonce},function(e){jQuery(".mp-spinner").hide(),nfPages.add({num:e.new_part.num,divider_id:e.new_part.id,page_title:e.new_part.page_title,fields:e.new_part.fields}),nfPages.count++,_.each(e.new_part.fields,function(e){nfFields.add({id:e,metabox_state:0})}),nfPages.updateView(e.new_nav,e.new_slide,nfPages.count)})},remove:function(){var e=confirm(nf_mp.remove_page_text);if(e){var n=ninja_forms_settings.form_id,a=this.get("num"),i=nfPages.count;i>1&&jQuery("#ninja_forms_field_list_"+a).find("._page_divider-li").removeClass("not-sortable");var t=this.get("fields");if(t.length>0){jQuery(".mp-remove-page").find(".symbol").hide(),jQuery(".mp-remove-page").css("padding","4px 0 0 0"),jQuery(".mp-remove-page").find(".spinner").show(),move_to_page=a>1?a-1:1;var r=this,s=nf_mp_get_field_order();jQuery.post(ajaxurl,{form_id:n,fields:t,move_to_page:move_to_page,order:s,action:"nf_mp_delete_page",nf_ajax_nonce:ninja_forms_settings.nf_ajax_nonce},function(e){jQuery(".mp-remove-page").find(".spinner").hide(),jQuery(".mp-remove-page").css("padding","0"),jQuery(".mp-remove-page").find(".symbol").show(),nfPages.remove(r);var n=r.get("id"),a=nfFields.get(n);if(nfFields.remove(a),2==i)nfPages.reset(),jQuery("._page_divider-li").remove(),nfPages.updateView(e.new_nav,e.new_slide,1),jQuery("#ninja_forms_mp_pagination").fadeOut("fast"),jQuery("#nf_mp_enable").fadeIn();else{var t=1;_.each(nfPages.models,function(e){e.set("num",t),t++}),nfPages.updateView(e.new_nav,e.new_slide,move_to_page)}nfPages.count--})}}}}),nfPages=Backbone.Collection.extend({model:nfPage,enable:function(){jQuery("#nf_mp_enable").fadeOut();var e=ninja_forms_settings.form_id;jQuery.post(ajaxurl,{form_id:e,action:"nf_mp_enable",nf_ajax_nonce:ninja_forms_settings.nf_ajax_nonce},function(e){_.each(e.new_parts,function(e){nfPages.add({num:e.num,divider_id:e.id,page_title:"",fields:e.fields}),nfFields.add({id:e.id,metabox_state:0})}),nfPages.count=2,nfPages.updateView(e.new_nav,e.new_slide,1)})},addNew:function(){jQuery(".mp-add-page").find(".symbol").hide(),jQuery(".mp-add-page").css("padding","4px 0 0 0"),jQuery(".mp-add-page").find(".spinner").show(),nfFields.updateData();var e=ninja_forms_settings.form_id,n=this,a=nf_mp_get_field_order();jQuery.post(ajaxurl,{form_id:e,order:a,action:"nf_mp_new_page",nf_ajax_nonce:ninja_forms_settings.nf_ajax_nonce},function(e){n.count++,n.add([{num:n.count,fields:e.new_part.fields,divider_id:e.new_part.id}]),nfFields.add({id:e.new_part.id,metabox_state:0}),n.updateView(e.new_nav,e.new_slide,nfPages.count),jQuery(document).triggerHandler("nfMpAddPart",[e]),jQuery(".mp-add-page").find(".spinner").hide(),jQuery(".mp-add-page").find(".symbol").show()})},updateView:function(e,n,a){jQuery("#ninja_forms_mp_pagination").html(e),jQuery("#ninja-forms-slide").html(n),this.updateSortables(),jQuery("#ninja_forms_mp_pagination").fadeIn(),0!=a&&nf_mp_change_page(a)},updateSortables:function(){jQuery(".ninja-forms-field-list").sortable({handle:".menu-item-handle",items:"li:not(.not-sortable)",connectWith:".ninja-forms-field-list",start:function(e,n){var a=jQuery(n.item).find(".wp-editor-wrap").length;a>0&&jQuery(n.item).find(".wp-editor-wrap").each(function(){var e=this.id.replace("wp-","");e=e.replace("-wrap",""),tinyMCE.execCommand("mceRemoveControl",!1,e)})},stop:function(e,n){var a=jQuery(n.item).find(".wp-editor-wrap").length;a>0&&jQuery(n.item).find(".wp-editor-wrap").each(function(){var e=this.id.replace("wp-","");e=e.replace("-wrap",""),tinyMCE.execCommand("mceAddControl",!0,e)}),jQuery(this).sortable("refresh"),nfForm.set("saved",!1)}}),jQuery(".mp-add-page").droppable({accept:".ninja-forms-field-list li",hoverClass:"drop-hover",tolerance:"pointer",drop:function(e,n){var a=n.draggable;jQuery(document).on("nfMpAddPart.drop",function(){a.hide("slow",function(){jQuery(this).appendTo("#ninja_forms_field_list_"+nfPages.count).show("slow")})}),nfPages.addNew()}}),jQuery("#mp-page-list").sortable({helper:"clone",tolerance:"pointer",update:function(){var e=!1;jQuery("#mp-page-list li").each(function(n){var a=n+1,i=jQuery(this).data("page");jQuery(this).data("page",a),jQuery(this).html(a),jQuery(this).prop("id","ninja_forms_mp_page_"+a),nfPages.findWhere({num:i}).set("new_num",a),jQuery("#ninja_forms_field_list_"+i).data("page",a),nfPages.current_page!=i||e||(nfPages.current_page=a,e=!0)}),nfPages.each(function(e){var n=(e.get("num"),e.get("new_num"));e.set("num",n),e.unset("new_num")});var n=jQuery("#ninja-forms-slide");uls=n.children("ul"),uls.each(function(){var e=jQuery(this).data("page");jQuery(this).prop("id","ninja_forms_field_list_"+e)}),uls.detach().sort(function(e,n){return jQuery(e).data("page")-jQuery(n).data("page")}),n.append(uls),nf_mp_change_page(nfPages.current_page)}}),jQuery("#mp-page-list").disableSelection(),jQuery(".mp-page-nav").droppable({accept:".ninja-forms-field-list li",hoverClass:"drop-hover",tolerance:"pointer",drop:function(e,n){var a=jQuery(this).data("page");n.draggable.hide("slow",function(){jQuery(this).appendTo("#ninja_forms_field_list_"+a).show("slow")})}})}});nfForm.saveTitle=function(){var e=jQuery("#modal-contents-wrapper").find("#nf-form-title").val(),n=this.get("show_insert_submit"),a=jQuery("#modal-contents-wrapper").find("#nf-insert-submit").prop("checked");if(this.set("title",e),this.set("status",""),n&&a){var i=this;jQuery(document).on("addField.insertSubmit",function(e,n){jQuery("#ninja_forms_field_"+n.new_id+"_toggle").click(),jQuery("#nf-save-title").nfAdminModal("close"),i.save(),jQuery(document).off("addField.insertSubmit")}),nfPages.count>1?nf_mp_change_page(nfPages.count,function(){jQuery("#_submit").click()}):jQuery("#_submit").click()}else jQuery("#nf-save-title").nfAdminModal("close"),this.save()};var nfPages=new nfPages;jQuery(document).ready(function(e){if(nfPages.current_page=1,nfPages.count=1,"undefined"!=typeof nf_mp.pages){var n=1;_.each(nf_mp.pages,function(e){nfPages.add({num:n,divider_id:e.id,page_title:e.page_title,fields:e.fields}),n++}),nfPages.count=n-1}e(document).on("click",".mp-add-page",function(e){e.preventDefault(),nfPages.addNew()}),e(document).on("click","#nf_mp_enable",function(e){e.preventDefault(),nfPages.enable()}),e(document).on("click",".mp-page-nav",function(){var n=e(this).data("page"),a=nfPages.current_page;n!=a&&nf_mp_change_page(n)}),e(document).on("click",".mp-remove-page",function(){var e=nfPages.current_page,n=nfPages.findWhere({num:e});n.remove()}),e(document).on("nfAdminSaveFields.mpFilter",function(){e("._page_divider-li").removeClass("not-sortable"),e(".ninja-forms-field-list").sortable("refresh");var n="";e(".ninja-forms-field-list").each(function(){""!=n&&(n+=","),n+=e(this).sortable("toArray")}),n=n.split(",");for(var a={},i=0;i<n.length;i++)a[i]=n[i];a=JSON.stringify(a),e(document).data("field_order",a)}),e(document).off("addField.default"),e(document).on("addField.mpAdd",function(e,n){var a=nfPages.current_page;jQuery("#ninja_forms_field_list_"+a).append(n.new_html);var i=n.new_id;if("List"==n.new_type&&jQuery(".ninja-forms-field-list-options").sortable({helper:"clone",handle:".ninja-forms-drag",items:"div",placeholder:"ui-state-highlight"}),"undefined"!=typeof nf_ajax_rte_editors)for(var t=nf_ajax_rte_editors.length-1;t>=0;t--){var r=nf_ajax_rte_editors[t];tinyMCE.init(tinyMCEPreInit.mceInit[r]);try{quicktags(tinyMCEPreInit.qtInit[r])}catch(e){}}jQuery("#ninja_forms_field_"+i+"_inside").find(".nf-field-settings .inside").each(function(){var e=jQuery.trim(jQuery(this).html());""==e&&jQuery(this).parent().remove()}),nfFields.add({id:n.new_id,metabox_state:1});var s=nfPages.findWhere({num:a});if("undefined"!=typeof s){var d=s.get("fields");d.push(n.new_id.toString()),s.set("fields",d)}}),e(document).on("removeField",function(e,n){var a=nfPages.findWhere({num:nfPages.current_page});if("undefined"!=typeof a){var i=a.get("fields");i=nf_mp_remove_array_value(i,n),a.set("fields",i)}}),e(document).on("click",".mp-copy-page",function(e){e.preventDefault();var n=nfPages.current_page,a=nfPages.findWhere({num:n});a.duplicate()}),e("#mp-page-list").disableSelection(),nfPages.updateSortables()});