function ninja_forms_mp_change_page(e,t){if(!t){var t=""}jQuery("#_current_page").val(e);jQuery(".mp-page").removeClass("active");jQuery("#ninja_forms_mp_page_"+e).addClass("active");var n=jQuery("#ninja_forms_field_list_"+e).position().left;jQuery("#ninja-forms-slide").animate({left:-n},"300",t)}function ninja_forms_new_field_response(e){var t=jQuery(".mp-page.active").attr("title");jQuery("#ninja_forms_field_list_"+t).append(e.new_html);if(typeof e.edit_options!="undefined"){for(var n=0;n<e.edit_options.length;n++){if(e.edit_options[n].type=="rte"){var r="ninja_forms_field_"+e.new_id+"["+e.edit_options[n].name+"]";tinyMCE.execCommand("mceRemoveControl",false,r);tinyMCE.execCommand("mceAddControl",true,r)}}}jQuery(".ninja-forms-field-conditional-cr-field").each(function(){jQuery(this).append('<option value="'+e.new_id+'">'+e.new_type+"</option>")});jQuery("#ninja_forms_field_"+e.new_id+"_toggle").click();jQuery("#ninja_forms_field_"+e.new_id+"_label").focus()}function ninja_forms_mp_add_page(e){var t=jQuery(".mp-page").length;var n=t+1;var r='<ul class="menu ninja-forms-field-list" id="ninja_forms_field_list_'+n+'" data-order="'+n+'"></ul>';var i='<li class="active mp-page" title="'+n+'" id="ninja_forms_mp_page_'+n+'">'+n+"</li>";jQuery("#mp-page-list").append(i);jQuery(".mp-page").droppable({accept:".ninja-forms-field-list li",hoverClass:"drop-hover",tolerance:"pointer",drop:function(e,t){var n=this.title;t.draggable.hide("slow",function(){jQuery(this).appendTo("#ninja_forms_field_list_"+n).show("slow")})}});jQuery("#ninja-forms-slide").append(r);jQuery("#ninja_forms_field_list_"+n).append(e.new_html);ninja_forms_mp_change_page(n,ninja_forms_mp_page_added)}function ninja_forms_mp_page_added(){var e=jQuery(".mp-page:last").attr("title");var t=jQuery(".mp-page-name:last").prop("id");t=t.replace("ninja_forms_field_","");t=t.replace("_page_name","");jQuery("#ninja_forms_field_"+t+"_page_name").focus();jQuery("#ninja_forms_field_list_"+e).sortable({handle:".menu-item-handle",items:"li:not(.not-sortable)",connectWith:".ninja-forms-field-list",start:function(e,t){var n=jQuery(t.item).find(".wp-editor-wrap").length;if(n>0){jQuery(t.item).find(".wp-editor-wrap").each(function(){var e=this.id.replace("wp-","");e=e.replace("-wrap","");tinyMCE.execCommand("mceRemoveControl",false,e)})}},stop:function(e,t){var n=jQuery(t.item).find(".wp-editor-wrap").length;if(n>0){jQuery(t.item).find(".wp-editor-wrap").each(function(){var e=this.id.replace("wp-","");e=e.replace("-wrap","");tinyMCE.execCommand("mceAddControl",true,e)})}jQuery(this).sortable("refresh")}});jQuery(".spinner").hide()}function ninja_forms_mp_hide_spinner(){jQuery(".spinner").hide()}function ninja_forms_mp_serialize_data(e){var t=jQuery("#ninja_forms_field_"+e).find(":input[name^=ninja_forms_field_"+e+"]");var n=jQuery(t).serializeFullArray();return n}jQuery(document).ready(function(e){e(document).on("click",".mp-page",function(t){var n=this.title;var r=e(".mp-page.active").attr("title");if(n!=r){ninja_forms_mp_change_page(n)}});e(".ninja-forms-save-data").click(function(t){e(".page-divider").removeClass("not-sortable");e(".ninja-forms-field-list").sortable("refresh");var n="";e(".ninja-forms-field-list").each(function(){if(n!=""){n=n+","}n=n+e(this).sortable("toArray")});e("#ninja_forms_field_order").val(n)});e("#mp-page-list").sortable({helper:"clone",tolerance:"pointer",update:function(t,n){e("#mp-page-list li").each(function(t){var n=t+1;e("#ninja_forms_field_list_"+e(this).prop("title")).data("order",n);e(this).prop("title",n);e(this).prop("id","ninja_forms_mp_page_"+n);e(this).html(n)});var r=e("#ninja-forms-slide");uls=r.children("ul");uls.detach().sort(function(t,n){return e(t).data("order")-e(n).data("order")});uls.each(function(t){var n=t+1;e(this).prop("id","ninja_forms_field_list_"+n)});r.append(uls);if(e(n.item).hasClass("active")){e("#_current_page").val(e(n.item).prop("title"))}var i=e("#_current_page").val();ninja_forms_mp_change_page(i)}});e("#mp-page-list").disableSelection();e(".mp-page").droppable({accept:".ninja-forms-field-list li",hoverClass:"drop-hover",tolerance:"pointer",drop:function(t,n){e(".spinner").show();var r=this.title;n.draggable.hide("slow",function(){e(this).appendTo("#ninja_forms_field_list_"+r).show("slow");e(".spinner").hide()})}});e(".mp-add").click(function(){var t="_page_divider";var n=e("#_form_id").val();e(".spinner").show();e.post(ajaxurl,{type:t,form_id:n,action:"ninja_forms_new_field",nf_ajax_nonce:ninja_forms_settings.nf_ajax_nonce},ninja_forms_mp_add_page)});e(".mp-add").droppable({accept:".ninja-forms-field-list li",hoverClass:"drop-hover",tolerance:"pointer",drop:function(t,n){var r="_page_divider";var i=e("#_form_id").val();e(".spinner").show();e.post(ajaxurl,{type:r,form_id:i,action:"ninja_forms_new_field",nf_ajax_nonce:ninja_forms_settings.nf_ajax_nonce},function(t){ninja_forms_mp_add_page(t);var r=jQuery(".mp-page").length;n.draggable.hide("slow",function(){e(this).appendTo("#ninja_forms_field_list_"+r).show("slow")})})}});e(".mp-subtract").click(function(){var t=confirm("Really delete this page? All fields will be removed.");if(t){var n=e("#_form_id").val();var r=e(".mp-page.active").attr("title");var i=e(".mp-page").length;if(i>1){e("#ninja_forms_field_list_"+r).find(".page-divider").removeClass("not-sortable")}var s=e("#ninja_forms_field_list_"+r).sortable("toArray");if(s!=""){e(".spinner").show();e.post(ajaxurl,{form_id:n,fields:s,action:"ninja_forms_mp_delete_page",nf_ajax_nonce:ninja_forms_settings.nf_ajax_nonce},function(t){if(i==1){for(var n=s.length-1;n>=0;n--){e("#"+s[n]).remove()}}else{if(r>1){move_to_page=r-1}else{move_to_page=1}e("#ninja_forms_field_list_"+r).remove();e("#ninja_forms_mp_page_"+r).remove();var n=1;e(".mp-page").each(function(){e(this).prop("id","ninja_forms_mp_page_"+n);e(this).prop("innerHTML",n);e(this).attr("title",n);n++});var o=e("#ninja-forms-slide");uls=o.children("ul");uls.detach().sort(function(t,n){return e(t).data("order")-e(n).data("order")});uls.each(function(t){var n=t+1;e(this).prop("id","ninja_forms_field_list_"+n)});o.append(uls);ninja_forms_mp_change_page(move_to_page,ninja_forms_mp_hide_spinner)}})}}});e(document).on("click",".ninja-forms-mp-copy-page",function(t){t.preventDefault();var n=e("#_form_id").val();var r=e(".mp-page.active").attr("title");var i=e(".mp-page").length;var s={};e("#ninja_forms_field_list_"+r).find(".page-divider").removeClass("not-sortable");e("#ninja_forms_field_list_"+r).sortable("refresh");var o=e("#ninja_forms_field_list_"+r).sortable("toArray");if(o!=""){for(var u=o.length-1;u>=0;u--){var a=o[u].replace("ninja_forms_field_","");s[u]=ninja_forms_mp_serialize_data(a)}e(".spinner").show();e.post(ajaxurl,{form_id:n,field_data:s,action:"ninja_forms_mp_copy_page",nf_ajax_nonce:ninja_forms_settings.nf_ajax_nonce},ninja_forms_mp_add_page)}})})